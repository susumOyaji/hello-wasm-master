<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>rewards-search</title>
    <link rel="icon" href="./favicon.ico" type="image/x-icon">
    <style>
        body {
            font-size: 12px;
            /* bodyã‚¿ã‚°ã®æ–‡å­—ã‚µã‚¤ã‚ºã‚’æŒ‡å®š */
        }

        h1 {
            font-size: 32px;
            /* h1ã‚¿ã‚°ã®æ–‡å­—ã‚µã‚¤ã‚ºã‚’æŒ‡å®š */
        }

        h2 {
            font-size: 16px;
            /* h2ã‚¿ã‚°ã®æ–‡å­—ã‚µã‚¤ã‚ºã‚’æŒ‡å®š */
            margin-bottom: 0px;
            /* h2ã‚¿ã‚°ã®ä¸‹å´ã®ãƒãƒ¼ã‚¸ãƒ³ã‚’æŒ‡å®š */
            color: #0011ff;
            /* h2ã‚¿ã‚°ã®æ–‡å­—è‰²ã‚’é’ã«æŒ‡å®š */
        }

        h3 {
            font-size: 16px;
            /* h2ã‚¿ã‚°ã®æ–‡å­—ã‚µã‚¤ã‚ºã‚’æŒ‡å®š */
            margin-top: 0px;
            /* h2ã‚¿ã‚°ã®ä¸‹å´ã®ãƒãƒ¼ã‚¸ãƒ³ã‚’æŒ‡å®š */
            margin-bottom: 0px;
            /* h2ã‚¿ã‚°ã®ä¸‹å´ã®ãƒãƒ¼ã‚¸ãƒ³ã‚’æŒ‡å®š */
            color: #0011ff;
            ;
            /* h2ã‚¿ã‚°ã®æ–‡å­—è‰²ã‚’é’ã«æŒ‡å®š */
        }

        p {
            font-size: 14px;
            /* pã‚¿ã‚°ã®æ–‡å­—ã‚µã‚¤ã‚ºã‚’æŒ‡å®š */
        }

      

        .h2-list {
            padding: 10px;
            border: 1px solid #ddd;
            margin-bottom: 20px;
            position: fixed;
            /* å›ºå®šä½ç½® */
            top: 20px;
            /* ä¸Šã‹ã‚‰20px */
            right: 20px;
            /* å³ã‹ã‚‰20px */
            width: 350px;
            /* å¹…ã‚’æŒ‡å®š */
            max-height: 500px;
            /* æœ€å¤§é«˜ã•ã‚’æŒ‡å®šï¼ˆé©å®œèª¿æ•´ï¼‰ */
            overflow: auto;
            /* ã¯ã¿å‡ºã—ãŸã‚‰ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã« */
            background-color: white;
            /* èƒŒæ™¯è‰² */
            z-index: 1000;
            /* ä»–ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚ˆã‚Šå‰ã«è¡¨ç¤º */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            /* å°‘ã—å½±ã‚’ã¤ã‘ã‚‹ */
            font-size: 15px;
            /* ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’æŒ‡å®š */
            line-height: 1.5;
            /* è¡Œé–“ã‚’èª¿æ•´ï¼ˆæ¨å¥¨ï¼‰ */
            font-family: Arial, sans-serif;
            /* ãƒ•ã‚©ãƒ³ãƒˆæŒ‡å®šï¼ˆãŠå¥½ã¿ã§ï¼‰ */
        }

        .h2-item {
            cursor: pointer;
            padding: 5px;
            border-bottom: 1px solid #ddd;
        }

        .h2-item:hover {
            background-color: #f0f0f0;
        }

        .highlight {
            background-color: yellow;
        }
    </style>
</head>

<body>
    <h3>ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ä½¿ã£ã¦æ¤œç´¢</h3>

    <button onclick="getNextElementInBody()">é¸æŠã•ã‚ŒãŸé …ç›®ã®æ¬¡ã‚’å–å¾—</button>


    <h1>Rewards Search Keyword</h1>
    <div id="h2-list" class="h2-list"></div> <!-- ã“ã“ã« h2 ã‚¿ã‚°ã®ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º -->



    <script type="module">import init from './pkg/hello_wasm.js';





        // é¸æŠã•ã‚ŒãŸãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®æ¬¡ã®è¦ç´ ã‚’å–å¾—
        // ãƒã‚§ãƒƒã‚¯ã•ã‚ŒãŸ h2 ã®æ¬¡ã®è¦ç´ ã‚’å–å¾—ã™ã‚‹
        function getNextElementInBody() {
            let checkedItems = [];
            let clipboard = [];
            let h2Elements = document.querySelectorAll("h2");
            let items = document.querySelectorAll(".h2-item");

            items.forEach((item, index) => {
                let checkbox = item.querySelector("input[type='checkbox']");
                if (checkbox.checked) {
                    let h2Text = checkbox.nextElementSibling.textContent;

                    // body å†…ã‹ã‚‰ h2 ã‚¿ã‚°ã‚’æ¤œç´¢ã—ã€æ¬¡ã®è¦ç´ ã‚’å–å¾—
                    h2Elements.forEach((h2, i) => {
                        if (h2.textContent === h2Text) {
                            let nextElement = h2.nextElementSibling; // æ¬¡ã®è¦ç´ ã‚’å–å¾—
                            if (nextElement) {
                                checkedItems.push(`ã€Œ${h2Text}ã€ã®æ¬¡ã®è¦ç´ : ${nextElement.tagName} -> ${nextElement.textContent.trim()}`);
                                clipboard.push(`${nextElement.textContent.trim()}`);
                            } else {
                                checkedItems.push(`ã€Œ${h2Text}ã€ã®æ¬¡ã«è¦ç´ ãŒã‚ã‚Šã¾ã›ã‚“`);
                            }
                        }
                    });
                }
            });

            alert(checkedItems.length > 0 ? checkedItems.join("\n") : "é¸æŠã•ã‚ŒãŸé …ç›®ãŒã‚ã‚Šã¾ã›ã‚“");

            navigator.clipboard.writeText(clipboard.join("\n"));

            if (clipboard.length > 0) {  // ç©ºé…åˆ—ã‚’é˜²ã
                clipboard.join("-").split("-").forEach(word => {
                    window.open("https://www.bing.com/search?setlang=ja&cc=jp&cc=JP&q=" + encodeURIComponent(word));
                    //alert(`${clipboard.length}:  ${word}:   é¸æŠã•ã‚ŒãŸé …ç›®ã®æ¬¡ã®è¦ç´ ã€‚`);
                });
            } else {
                alert("ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ãŒç©ºã§ã™ã€‚");
            }

        }
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã«ç™»éŒ²
        window.getNextElementInBody = getNextElementInBody;

        async function run() {
            await init();
            const checkH2Loaded = setInterval(() => {
                if (document.querySelectorAll("h2").length > 0) {
                    clearInterval(checkH2Loaded);
                    displayH2List(); // h2ã‚¿ã‚°ã®ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
                }
            }, 500);


        }
        run();


        function extractKeyword(h2Text) {
            const regex = /ã€(.*?)ã€/g; // éµæ‹¬å¼§ä»˜ãã§ãƒ†ã‚­ã‚¹ãƒˆã‚’æŠ½å‡ºã™ã‚‹æ­£è¦è¡¨ç¾
            const match = h2Text.match(regex);
            return match ? match[1] : null; // ãƒãƒƒãƒã—ãŸå ´åˆã€ãã®ä¸­èº«ã‚’è¿”ã™ã€‚ãƒãƒƒãƒã—ãªã‘ã‚Œã° null ã‚’è¿”ã™
        }

        // ä½¿ç”¨ä¾‹
        const h2Elements = document.querySelectorAll("h2");
        h2Elements.forEach(h2 => {
            const keyword = extractKeyword(h2.textContent);
            if (keyword) {
                console.log("æŠ½å‡ºã—ãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰:", keyword);
            } else {
                console.log("ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ");
            }
        });





        function displayH2List() {
            const h2Elements = document.querySelectorAll("h2");
            const listContainer = document.getElementById("h2-list");
            listContainer.innerHTML = "<h3>ğŸ” ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’é¸æŠ:</h3>";

            h2Elements.forEach((h2, index) => {
                let listItem = document.createElement("div");
                listItem.classList.add("h2-item");

                // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’ä½œæˆ
                let checkbox = document.createElement("input");
                checkbox.type = "checkbox";
                checkbox.classList.add("h2-checkbox");

                // ãƒ©ãƒ™ãƒ«ã‚’ä½œæˆ
                let label = document.createElement("span");

                label.textContent = h2.textContent; // h2ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—

                // listItem ã«ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã¨ãƒ†ã‚­ã‚¹ãƒˆã‚’è¿½åŠ 
                listItem.appendChild(checkbox);
                listItem.appendChild(label);
                listContainer.appendChild(listItem);
            });
        }


    </script>


</body>

</html>