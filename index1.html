<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>rewards-search</title>
    <link rel="icon" href="./pkg/favicon.ico" type="image/x-icon">
    <style>
        body {
            font-size: 12px; /* bodyã‚¿ã‚°ã®æ–‡å­—ã‚µã‚¤ã‚ºã‚’æŒ‡å®š */
        }
        h1 {
            font-size: 32px; /* h1ã‚¿ã‚°ã®æ–‡å­—ã‚µã‚¤ã‚ºã‚’æŒ‡å®š */
        }
        h2 {
            font-size: 16px; /* h2ã‚¿ã‚°ã®æ–‡å­—ã‚µã‚¤ã‚ºã‚’æŒ‡å®š */
            margin-bottom: 0px; /* h2ã‚¿ã‚°ã®ä¸‹å´ã®ãƒãƒ¼ã‚¸ãƒ³ã‚’æŒ‡å®š */
            color: #0011ff; /* h2ã‚¿ã‚°ã®æ–‡å­—è‰²ã‚’é’ã«æŒ‡å®š */
        }
        p {
            font-size: 14px; /* pã‚¿ã‚°ã®æ–‡å­—ã‚µã‚¤ã‚ºã‚’æŒ‡å®š */
        }
        /* ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .search-container {
            position: fixed;
            top: 80px;
            left: 20px;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            transition: all 0.3s ease-in-out;
            width: 150px; /* åˆæœŸã‚µã‚¤ã‚ºã‚’å°ã•ã */
            overflow: hidden;
        }

        .search-container.active {
            width: 250px; /* åºƒãŒã‚‹ */
        }   

        .search-input {
            border: none;
            outline: none;
            padding: 8px;
            width: 200px;
            font-size: 16px;
            transition: opacity 0.3s ease-in-out;
        }

        .search-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
        }

        .search-container.active .search-input {
            opacity: 1;
        }
        .spacer {
            height: 50px; /* é«˜ã•ã‚’èª¿æ•´ */
        }
    </style>
</head>
<body>
    <div class="search-container">
        <input type="text" id="searchInput" class="search-input" placeholder="ãƒšãƒ¼ã‚¸å†…æ¤œç´¢..." onkeydown="handleKeyPress(event)">
        <button class="search-button" onclick="startSearch()">ğŸ”</button>
    </div>
    <h1>Rewards Search Keyword</h1>
    <div class="spacer"></div> <!-- æ”¹è¡Œã®ä»£ã‚ã‚Šã«ã‚¹ãƒšãƒ¼ã‚µãƒ¼ã‚’æŒ¿å…¥ -->
    <script type="module">
        import init from './pkg/hello_wasm.js';

        async function run() {
            /* Wasmã®åˆæœŸåŒ–*/
            await init();
            /* Rustã®mainé–¢æ•°ã‚’å‘¼ã³å‡ºã™*/
            /*ç¾åœ¨ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã€mainé–¢æ•°ã«#[wasm_bindgen(start)]ã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆãŒä»˜ã„ã¦ã„ã‚‹ãŸã‚ã€
            Wasmãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒåˆæœŸåŒ–ã•ã‚ŒãŸã¨ãã«è‡ªå‹•çš„ã«mainé–¢æ•°ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
            ãã®ãŸã‚ã€JavaScriptå´ã§mainé–¢æ•°ã‚’æ˜ç¤ºçš„ã«å‘¼ã³å‡ºã™å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚*/
            /*await main();*/
        }
        run();

        let lastSearch = ""; // å‰å›ã®æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰ã‚’ä¿å­˜
        let lastResult = false; // æ¤œç´¢çµæœã®æˆå¦ã‚’è¨˜éŒ²

        function toggleSearch() {
            const container = document.querySelector('.search-container');
            const input = document.getElementById('searchInput');

            container.classList.toggle('active');

        if (container.classList.contains('active')) {
            input.focus(); // æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ ãŒé–‹ã„ãŸã‚‰è‡ªå‹•ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
        }
        }

        // ğŸ” æ¤œç´¢é–‹å§‹ï¼ˆæˆåŠŸãƒ»å¤±æ•—ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºï¼‰
        function startSearch() {
            const input = document.getElementById('searchInput');
            const query = input.value.trim();

    if (query) {
        let found;
        if (query !== lastSearch) {
            // æ–°ã—ã„æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰ãªã‚‰æœ€åˆã®ãƒãƒƒãƒã‚’æ¢ã™
            found = window.find(query, false, false, true, false, true);
            lastSearch = query;
        } else {
            // åŒã˜ãƒ¯ãƒ¼ãƒ‰ãªã‚‰æ¬¡ã®ãƒãƒƒãƒã‚’æ¢ã™
            found = window.find(query, false, true, true, false, true);
        }

        if (found) {
            showMessage("ğŸ” ã€Œ" + query + "ã€ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼", "success");
            lastResult = true;
        } else {
            showMessage("âŒ ã€Œ" + query + "ã€ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚", "error");
            lastResult = false;
        }
    }
}

 // Enterã‚­ãƒ¼ã§æ¤œç´¢é–‹å§‹
 function handleKeyPress(event) {
            if (event.key === 'Enter') {
                console.log('Key pressed:', event.key);
                startSearch();
            }
        }

// âœ… æ¤œç´¢æˆåŠŸãƒ»å¤±æ•—æ™‚ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒšãƒ¼ã‚¸ã«è¡¨ç¤º
function showMessage(msg, type) {
    let messageBox = document.getElementById("searchMessage");
    if (!messageBox) {
        messageBox = document.createElement("div");
        messageBox.id = "searchMessage";
        messageBox.style.position = "fixed";
        messageBox.style.bottom = "60px";
        messageBox.style.right = "20px";
        messageBox.style.padding = "10px";
        messageBox.style.borderRadius = "5px";
        messageBox.style.color = "white";
        messageBox.style.fontSize = "14px";
        messageBox.style.zIndex = "1000";
        document.body.appendChild(messageBox);
    }

    messageBox.style.backgroundColor = type === "success" ? "#28a745" : "#dc3545";
    messageBox.textContent = msg;
    messageBox.style.display = "block";

    // 3ç§’å¾Œã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’éè¡¨ç¤º
    setTimeout(() => {
        messageBox.style.display = "none";
    }, 3000);

}
 // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
 document.addEventListener("DOMContentLoaded", function() {
            document.getElementById('searchInput').addEventListener('keydown', handleKeyPress);
        });
//document.getElementById('searchInput').addEventListener('keydown', handleKeyPress)

       
    </script>
</body>
</html>
