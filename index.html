<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>rewards-search</title>
    <link rel="icon" href="./favicon.ico" type="image/x-icon">
    <style>
        body {
            font-size: 12px; /* bodyã‚¿ã‚°ã®æ–‡å­—ã‚µã‚¤ã‚ºã‚’æŒ‡å®š */
        }
        h1 {
            font-size: 32px; /* h1ã‚¿ã‚°ã®æ–‡å­—ã‚µã‚¤ã‚ºã‚’æŒ‡å®š */
        }
        h2 {
            font-size: 16px; /* h2ã‚¿ã‚°ã®æ–‡å­—ã‚µã‚¤ã‚ºã‚’æŒ‡å®š */
            margin-bottom: 0px; /* h2ã‚¿ã‚°ã®ä¸‹å´ã®ãƒãƒ¼ã‚¸ãƒ³ã‚’æŒ‡å®š */
            color: #0011ff; /* h2ã‚¿ã‚°ã®æ–‡å­—è‰²ã‚’é’ã«æŒ‡å®š */
        }
        h3 {
            font-size: 16px; /* h2ã‚¿ã‚°ã®æ–‡å­—ã‚µã‚¤ã‚ºã‚’æŒ‡å®š */
            margin-top: 0px; /* h2ã‚¿ã‚°ã®ä¸‹å´ã®ãƒãƒ¼ã‚¸ãƒ³ã‚’æŒ‡å®š */
            margin-bottom: 0px; /* h2ã‚¿ã‚°ã®ä¸‹å´ã®ãƒãƒ¼ã‚¸ãƒ³ã‚’æŒ‡å®š */
            color: #0011ff;; /* h2ã‚¿ã‚°ã®æ–‡å­—è‰²ã‚’é’ã«æŒ‡å®š */
        }
        p {
            font-size: 14px; /* pã‚¿ã‚°ã®æ–‡å­—ã‚µã‚¤ã‚ºã‚’æŒ‡å®š */
        }
        /* ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .search-container {
            position: fixed;
            top: 80px;
            left: 20px;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            transition: all 0.3s ease-in-out;
            width: 150px; /* åˆæœŸã‚µã‚¤ã‚ºã‚’å°ã•ã */
            overflow: hidden;
        }

        .search-container.active {
            width: 250px; /* åºƒãŒã‚‹ */
        }   

        .search-input {
            border: none;
            outline: none;
            padding: 8px;
            width: 200px;
            font-size: 16px;
            transition: opacity 0.3s ease-in-out;
        }

        .search-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
        }

        .search-container.active .search-input {
            opacity: 1;
        }
        .spacer {
            height: 50px; /* é«˜ã•ã‚’èª¿æ•´ */
        }
        .h2-list {
            padding: 10px;
            border: 1px solid #ddd;
            margin-bottom: 20px;
            position: fixed; /* å›ºå®šä½ç½® */
            top: 20px; /* ä¸Šã‹ã‚‰20px */
            right: 20px; /* å³ã‹ã‚‰20px */
            width: 350px; /* å¹…ã‚’æŒ‡å®š */
            max-height: 500px; /* æœ€å¤§é«˜ã•ã‚’æŒ‡å®šï¼ˆé©å®œèª¿æ•´ï¼‰ */
            overflow: auto; /* ã¯ã¿å‡ºã—ãŸã‚‰ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã« */
            background-color: white; /* èƒŒæ™¯è‰² */
            z-index: 1000; /* ä»–ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚ˆã‚Šå‰ã«è¡¨ç¤º */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* å°‘ã—å½±ã‚’ã¤ã‘ã‚‹ */
        }

        .h2-item {
            cursor: pointer;
            padding: 5px;
            border-bottom: 1px solid #ddd;
        }

        .h2-item:hover {
            background-color: #f0f0f0;
        }

    </style>
</head>
<body>
    <h2>ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ä½¿ã£ã¦æ¤œç´¢</h2>
    <button onclick="searchFromClipboard()">ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰æ¤œç´¢</button>
    <button onclick="getNextElementInBody()">é¸æŠã•ã‚ŒãŸé …ç›®ã®æ¬¡ã‚’å–å¾—</button>


    <h1>Rewards Search Keyword</h1>
    <div id="h2-list" class="h2-list"></div> <!-- ã“ã“ã« h2 ã‚¿ã‚°ã®ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º -->

    

    <script type="module">
        import init from './pkg/hello_wasm.js';



        async function searchFromClipboard() {
            try {
                // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—
                let keywords = await navigator.clipboard.readText();
                
                if (keywords.trim()) {
                    keywords.split(" ").forEach(word => {
                        window.open("https://www.bing.com/search?q=" + encodeURIComponent(word));
                    });
                } else {
                    alert("ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ãŒç©ºã§ã™ã€‚");
                }
            } catch (err) {
                alert("ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã®èª­ã¿å–ã‚Šã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
                console.error(err);
            }
        }
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã«ç™»éŒ²
        window.searchFromClipboard = searchFromClipboard;

        // é¸æŠã•ã‚ŒãŸãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®æ¬¡ã®è¦ç´ ã‚’å–å¾—
        // ãƒã‚§ãƒƒã‚¯ã•ã‚ŒãŸ h2 ã®æ¬¡ã®è¦ç´ ã‚’å–å¾—ã™ã‚‹
function getNextElementInBody() {
    let checkedItems = [];
    let h2Elements = document.querySelectorAll("h2");
    let items = document.querySelectorAll(".h2-item");

    items.forEach((item, index) => {
        let checkbox = item.querySelector("input[type='checkbox']");
        if (checkbox.checked) {
            let h2Text = checkbox.nextElementSibling.textContent;
            
            // body å†…ã‹ã‚‰ h2 ã‚¿ã‚°ã‚’æ¤œç´¢ã—ã€æ¬¡ã®è¦ç´ ã‚’å–å¾—
            h2Elements.forEach((h2, i) => {
                if (h2.textContent === h2Text) {
                    let nextElement = h2.nextElementSibling; // æ¬¡ã®è¦ç´ ã‚’å–å¾—
                    if (nextElement) {
                        checkedItems.push(`ã€Œ${h2Text}ã€ã®æ¬¡ã®è¦ç´ : ${nextElement.tagName} -> ${nextElement.textContent.trim()}`);
                    } else {
                        checkedItems.push(`ã€Œ${h2Text}ã€ã®æ¬¡ã«è¦ç´ ãŒã‚ã‚Šã¾ã›ã‚“`);
                    }
                }
            });
        }
    });

    alert(checkedItems.length > 0 ? checkedItems.join("\n") : "é¸æŠã•ã‚ŒãŸé …ç›®ãŒã‚ã‚Šã¾ã›ã‚“");
}
 // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã«ç™»éŒ²
 window.getNextElementInBody = getNextElementInBody;

        async function run() {
            await init();
            const checkH2Loaded = setInterval(() => {
                if (document.querySelectorAll("h2").length > 0) {
                    console.log("âœ… <h2> ã‚¿ã‚°ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸï¼");
                    clearInterval(checkH2Loaded);
                    displayH2List(); // h2ã‚¿ã‚°ã®ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
                }
            }, 500);
    
    
        }
        run();

        function displayH2List() {
    const h2Elements = document.querySelectorAll("h2");
    const listContainer = document.getElementById("h2-list");
    listContainer.innerHTML = "<h3>ğŸ” ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’é¸æŠ:</h3>";

    h2Elements.forEach((h2, index) => {
        let listItem = document.createElement("div");
        listItem.classList.add("h2-item");

        // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’ä½œæˆ
        let checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.classList.add("h2-checkbox");

        // ãƒ©ãƒ™ãƒ«ã‚’ä½œæˆ
        let label = document.createElement("span");
        label.textContent = h2.textContent; // h2ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—

        // listItem ã«ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã¨ãƒ†ã‚­ã‚¹ãƒˆã‚’è¿½åŠ 
        listItem.appendChild(checkbox);
        listItem.appendChild(label);
        listContainer.appendChild(listItem);
    });
}
        
        function searchH2(keyword) {
            let found = false;
            document.querySelectorAll("h2").forEach(h2 => {
                if (h2.textContent === keyword) {
                    h2.classList.add("highlight");
                    h2.scrollIntoView({ behavior: "smooth", block: "center" });
                    found = true;
                } else {
                    h2.classList.remove("highlight");
                }
            });

            showMessage(found ? `ğŸ” ã€Œ${keyword}ã€ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼` : `âŒ ã€Œ${keyword}ã€ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚`, found ? "success" : "error");
        }

        function showMessage(msg, type) {
            let messageBox = document.getElementById("searchMessage");
            if (!messageBox) {
                messageBox = document.createElement("div");
                messageBox.id = "searchMessage";
                messageBox.style.position = "fixed";
                messageBox.style.bottom = "60px";
                messageBox.style.right = "20px";
                messageBox.style.padding = "10px";
                messageBox.style.borderRadius = "5px";
                messageBox.style.color = "white";
                messageBox.style.fontSize = "14px";
                messageBox.style.zIndex = "1000";
                document.body.appendChild(messageBox);
            }

            messageBox.style.backgroundColor = type === "success" ? "#28a745" : "#dc3545";
            messageBox.textContent = msg;
            messageBox.style.display = "block";

            setTimeout(() => {
                messageBox.style.display = "none";
            }, 3000);
        }
    </script>

    <style>
        .h2-list {
            padding: 10px;
            border: 1px solid #ddd;
            margin-bottom: 20px;
        }

        .h2-item {
            cursor: pointer;
            padding: 5px;
            border-bottom: 1px solid #ddd;
        }

        .h2-item:hover {
            background-color: #f0f0f0;
        }

        .highlight {
            background-color: yellow;
        }
    </style>
</body>
</html>
